<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preference Test - Plant Box</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <div class="container">
            <h1>Plant Box</h1>
            <nav>
                <ul>
                    <li><a href="index">Home</a></li>
                    <li><a href="about">About</a></li>
                    <li><a href="products">Products</a></li>
                    <li><a href="contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <section class="preference-test">
        <div class="container">
            <h2>Preferece Test</h2>
            <form id="preference-form">
                <label>What fruits do you prefer?</label>
                <div id="fruits">
                    <label><input type="checkbox" name="fruits" value="apple"> Apple</label>
                    <label><input type="checkbox" name="fruits" value="banana"> Banana</label>
                    <label><input type="checkbox" name="fruits" value="orange"> Orange</label>
                    <label><input type="checkbox" name="fruits" value="strawberry"> Strawberry</label>
                    <label><input type="checkbox" name="fruits" value="grape"> Grape</label>
                </div>
                <br>
                <label for="vegetables">What vegetables do you prefer?</label>
                <div id="vegetables">
                    <label><input type="checkbox" name="vegetables" value="carrot"> Carrot</label>
                    <label><input type="checkbox" name="vegetables" value="broccoli"> Broccoli</label>
                    <label><input type="checkbox" name="vegetables" value="spinach"> Spinach</label>
                    <label><input type="checkbox" name="vegetables" value="pepper"> Pepper</label>
                    <label><input type="checkbox" name="vegetables" value="cucumber"> Cucumber</label>
                </div>
                <br>
                <label for="herbs">What herbs do you prefer?</label>
                <div id="herbs">
                    <label><input type="checkbox" name="herbs" value="basil"> Basil</label>
                    <label><input type="checkbox" name="herbs" value="mint"> Mint</label>
                    <label><input type="checkbox" name="herbs" value="parsley"> Parsley</label>
                    <label><input type="checkbox" name="herbs" value="cilantro"> Cilantro</label>
                    <label><input type="checkbox" name="herbs" value="rosemary"> Rosemary</label>
                </div>
                <br>
                <label for="flowers">What flowers do you prefer?</label>
                <div id="flowers">
                    <label><input type="checkbox" name="flowers" value="rose"> Rose</label>
                    <label><input type="checkbox" name="flowers" value="tulip"> Tulip</label>
                    <label><input type="checkbox" name="flowers" value="sunflower"> Sunflower</label>
                    <label><input type="checkbox" name="flowers" value="daisy"> Daisy</label>
                    <label><input type="checkbox" name="flowers" value="lily"> Lily</label>
                </div>
                <br>
                <button type="submit" class="btn1">Next</button>
            </form>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    const token = localStorage.getItem('token');
                    if (!token) {
                        alert('You must be signed in to access this page.');
                        window.location.href = 'login.html'; // Redirect to login page
                        return;
                    }

                    // Handle form submission
                    document.getElementById('preference-form').addEventListener('submit', async (event) => {
                        event.preventDefault();

                        // Collect selected preferences
                        const fruits = Array.from(document.querySelectorAll('input[name="fruits"]:checked')).map(input => input.value);
                        const vegetables = Array.from(document.querySelectorAll('input[name="vegetables"]:checked')).map(input => input.value);
                        const herbs = Array.from(document.querySelectorAll('input[name="herbs"]:checked')).map(input => input.value);
                        const flowers = Array.from(document.querySelectorAll('input[name="flowers"]:checked')).map(input => input.value);


                        const preferences = { fruits, vegetables, herbs, flowers };

                        try {
                            const response = await fetch('http://localhost:8888/preferences', {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${token}`,
                                },
                                body: JSON.stringify({ preferences }),
                            });

                            const data = await response.json();
                            if (response.ok) {
                                alert(data.message);
                                window.location.href = 'gardener-test.html'; // Redirect to the next test
                            } else {
                                alert(data.message);
                            }
                        } catch (error) {
                            console.error('Error updating preferences:', error);
                            alert('An error occurred. Please try again.');
                        }
                    });
                });
            </script>
        </div>
    </section>
    <script src="js/app.js" type="module"></script>
</body>

</html>